
{{/* get file that matches the filename as specified as src="" in shortcode */}}
{{- $src := resources.GetMatch (.Get "src") -}}

{{- if in (.Get "src") "http" -}}
    <img src="{{$src}}" {{- with .Get "alt" -}}alt="{{.}}"{{- else -}}alt=""{{- end -}}>
{{- else -}}
{{- if in (.Get "src") ".gif" -}}
    <img src="{{$src.RelPermalink}}" {{- with .Get "alt" -}}alt="{{.}}"{{- else -}}alt=""{{- end -}}>
{{- else -}}
{{/* set image sizes, these are hardcoded for now */}}
{{- $tinyw := default "500x Lanczos" -}}
{{- $smallw := default "800x Lanczos" -}}
{{- $mediumw := default "1200x Lanczos" -}}
{{- $largew := default "1600x Lanczos" -}}

{{/* resize the src image to the given sizes */}}
{{- .Scratch.Set "tiny" ($src.Resize $tinyw) -}}
{{- .Scratch.Set "small" ($src.Resize $smallw) -}}
{{- .Scratch.Set "medium" ($src.Resize $mediumw) -}}
{{- .Scratch.Set "large" ($src.Resize $largew) -}}

{{/* add the processed images to the scratch */}}

{{- $tiny := .Scratch.Get "tiny" -}}
{{- $small := .Scratch.Get "small" -}}
{{- $medium := .Scratch.Get "medium" -}}
{{- $large := .Scratch.Get "large" -}}


{{- $img := dict "src" $src.Permalink "w" $src.Width "h" $src.Height -}}

{{/* only use images smaller than or equal to the src (original) image size */}}
                <img loading="lazy" class="center" width="{{$img.w}}" height="{{$img.h}}"
                {{- with .Get "sizes" -}}sizes='{{.}}'
                {{- else -}}
                    sizes="(min-width: 1380px) 750px, (min-width: 820px) 719px, (min-width: 740px) calc(-33.33vw + 875px), (min-width: 340px) calc(92.63vw - 39px), calc(100vw - 32px)"{{- end -}}
                srcset='
                {{- if ge $src.Width "500" -}}
                {{- with $tiny.RelPermalink -}}{{.}} 500w{{- end -}}
                {{- end -}}
                {{- if ge $src.Width "800" -}}
                {{- with $small.RelPermalink -}}, {{.}} 800w{{- end -}}
                {{- end -}}
                {{- if ge $src.Width "1200" -}}
                {{- with $medium.RelPermalink -}}, {{.}} 1200w{{- end -}}
                {{- end -}}
                {{- if ge $src.Width "1600" -}}
                {{- with $large.RelPermalink -}}, {{.}} 1600w{{- end -}}
                {{- end -}}'
                {{- if .Get (print $medium) -}}
                src="{{$medium.RelPermalink}}"
                {{- else -}}
                src="{{$src.RelPermalink}}"
            {{- end -}}
            {{- with .Get "alt" -}}alt="{{.}}"{{- else -}}alt=""{{- end -}}>
{{- end -}}
{{- end -}}
