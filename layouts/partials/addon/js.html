{{- if site.Params.enablejs -}}
{{- $fingerprint := site.Params.fingerprint -}}
{{- $development := eq (hugo.Environment) "development" -}}
{{- $darkmode := site.Params.addon.darkmode -}}
{{- $clipboard := site.Params.addon.copybutton -}}
{{- $global := slice $darkmode $clipboard }}
{{- $darkmodejs := resources.Get "js/darkmode.js" | minify -}}
{{- $clipboardjs := resources.Get "js/clipboard.js" | minify -}}
{{- $globaljs := slice $darkmodejs $clipboardjs | resources.Concat "js/src/global.js" | minify -}}
{{- if $development -}}
{{- if and $darkmode (not $global) -}}
<script src="{{- $darkmodejs.RelPermalink -}}" defer></script>
{{- end -}}
{{- if and (eq .Kind "page") $clipboard (not $global) -}}
<script src="{{- $clipboardjs.RelPermalink -}}" defer></script>
{{- end -}}
{{- if $global -}}
<script src="{{- $globaljs.RelPermalink -}}" defer></script>
{{- end -}}
{{- end -}}
{{- if and  (not $development) (not $global) -}}
{{- if and ($darkmode) (not $fingerprint) -}}
<script src="{{- $darkmodejs.RelPermalink -}}" defer crossorigin="anonymous" crossorigin="anonymous"></script>
{{- else -}}
{{- $darkmodefp := $darkmodejs | fingerprint "sha384" -}}
<script src="{{- $darkmodejs.RelPermalink -}}" defer integrity="{{- $darkmodefp.Data.Integrity -}}" crossorigin="anonymous"></script>
{{- end -}}
{{- if and ($clipboard) (not $fingerprint) -}}
<script src="{{- $clipboardjs.RelPermalink -}}" defer crossorigin="anonymous"></script>
{{- else -}}
{{- $clipboardfp := $clipboardjs | fingerprint "sha384" -}}
<script src="{{- $clipboardjs.RelPermalink -}}" defer integrity="{{- $clipboardfp.Data.Integrity -}}" crossorigin="anonymous"></script>
{{- end -}}
{{- end -}}
{{- if and (not $development) $global }}
{{- $globalfp := $globaljs | fingerprint "sha384" }}
<script src="{{- $globaljs.RelPermalink -}}" defer integrity="{{- $globalfp.Data.Integrity -}}" crossorigin="anonymous"></script>
{{- end -}}
{{- end -}}
<noscript><style>#darkmode {display: none;}</style></noscript>
