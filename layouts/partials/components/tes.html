{{- $src := resources.Get .img -}}
{{- $alt := .alt -}}
{{- $slice := slice 320 480 640 768 960 1280 1600 1920 -}}
{{- $srcset := slice -}}
{{- $colors := $src.Colors -}}
{{- if (lt ($colors | len) 2) -}}
	{{- $colors = $colors | append "#ffffff" -}}
{{- end -}}
{{- $bgcolors := delimit ($colors) ", " -}}
{{- $style := print "background: linear-gradient(" $bgcolors "); background-size: cover; background-repeat: no-repeat;" -}}
{{- range $slice -}}
    {{- if (le . $src.Width) -}}
        {{- $w := printf "%dx" . -}}
        {{- $url := ($src.Resize $w).RelPermalink | safeURL -}}
        {{- $url := printf "%s %dw" $url . -}}
        {{- $srcset = $srcset | append $url -}}
    {{- end -}}
{{- end -}}
{{- $set := delimit $srcset "," -}}
<div class="photo-container" {{- if (ge hugo.Version "0.104") -}}style="{{ $style | safeCSS }}"{{- end -}}>
    <picture>
        <img
        src="{{- $src.RelPermalink -}}"
        alt="{{- $alt -}}"
        width="{{- $src.Width -}}"
        height="{{- $src.Height -}}"
        srcset="{{- $set -}}"
        {{- with .loading -}}loading="{{- . -}}"{{- end -}}/>
    </picture>
</div>